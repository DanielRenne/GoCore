/*!
 * remark (http://getbootstrapadmin.com/remark)
 * Copyright 2017 amazingsurge
 * Licensed under the Themeforest Standard Licenses
 */
!function(t,a,e){"use strict";a.AppTaskboard=App.extend({stageTpl:function(t){return'<li class="taskboard-stage"><header class="taskboard-stage-header"><div class="taskboard-stage-actions pull-right"><div class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#" aria-expanded="false"><i class="icon md-chevron-down" aria-hidden="true"></i></a><ul class="dropdown-menu bullet" role="menu"><li role="presentation" class="taskboard-stage-rename"><a href="javascript:void(0)" role="menuitem"><i class="icon md-edit" aria-hidden="true"></i>Rename</a></li><li role="presentation" class="taskboard-stage-delete" ><a href="javascript:void(0)" role="menuitem"><i class="icon md-delete" aria-hidden="true"></i>Delete</a></li><li class="taskboard-stage-rename-wrap"><div class="form-group"><input class="form-control taskboard-stage-rename-input" type="text" value="'+t+'" name="name"></div><button class="btn btn-primary btn-block taskboard-stage-rename-save" type="button">Save</button></li></ul></div></div><h5 class="taskboard-stage-title">'+t+'</h5></header><div class="taskboard-stage-content"><ul class="list-group taskboard-list"></ul><div class="action-wrap"><a class="add-item-toggle" href="#"><i class="icon md-plus" aria-hidden="true"></i>Add Task</a><div class="add-item-wrap"><form class="add-item" role="form" method="post" action="#"><div class="form-group"><label class="control-label margin-bottom-15" for="name">Task name:</label><input class="form-control" type="text" placeholder="Task name" name="name"></div><div class="form-group text-right"><a class="btn btn-sm btn-white btn-flat add-item-cancel">Cancel</a><button type="button" class="btn btn-primary add-item-add">Add</button></div></form></div></div></div></li>'},taskTpl:function(t){return'<li class="list-group-item priority-'+t.priority+'" data-taskboard="slidePanel" data-url="panel.tpl"><div class="checkbox-custom checkbox-primary"><input type="checkbox" '+(t.complete?'checked="checked"':"")+' name="checkbox"><label class="task-title">'+t.title+'</label></div><div class="task-badges"></div><ul class="task-members"><li><img class="avatar avatar-sm" src="../../../../global/portraits/5.jpg"></li></div></li>'},badgesTpl:function(t,a){var e="";switch(t){case"duedate":e='<span class="task-badge task-badge-subtask icon md-calendar">'+a+"</span>";break;case"subtasks":e='<span class="task-badge task-badge-subtask icon md-format-list-bulleted">'+a+"</span>";break;case"attachments":e='<span class="task-badge task-badge-attachments icon md-attachment-alt">'+a+"</span>";break;case"comments":e='<span class="task-badge task-badge-comments icon md-comment">'+a+"</span>"}return e},membersTpl:function(t){return'<li><img class="avatar avatar-sm" src="'+t+'"></li>'},subtaskTpl:function(t){return'<li class="list-group-item subtask"><div class="checkbox-custom checkbox-primary"><input type="checkbox" '+(t.complete?'checked="checked"':"")+' name="checkbox"><label class="title">'+t.title+'</label></div><div class="subtask-editor"><form><div class="form-group"><input class="form-control subtask-title" type="text" name="title"></div><div class="form-group"><button class="btn btn-primary subtask-editor-save" type="button">Save</button><a class="btn btn-sm btn-white subtask-editor-delete" href="javascript:void(0)">Delete</a></div></form></div></li>'},attachmentTpl:function(t){return'<li class="list-group-item"><div class="meida"><div class="media-left"><div class="attachments-image"><img src="'+t.src+'"></div></div><div class="media-body"><p><span class="name">'+t.title+'</span><span</p><p><span class="size">'+t.size+'</span><span class="attachments-actions"><button class="btn btn-icon btn-pure" type="button"><i class="icon md-download" aria-hidden="true"></i></button><button class="btn btn-icon btn-pure" type="button"><i class="icon md-delete" aria-hidden="true"></i></button></span></p></div></div></li>'},commentTpl:function(t,a,e,s){return'<div class="comment media"><div class="media-left"><a class="avatar avatar-lg" href="javascript:void(0)"><img src="'+t+'" alt="..."></a></div><div class="media-body"><div class="comment-body"><a class="comment-author" href="javascript:void(0)">'+a+'</a><div class="comment-meta"><span class="date">'+e+'</span></div><div class="comment-content"><p>'+s+"</p></div></div></div></div>"},dataTpl:function(){return{status:!1,title:"",description:"",priority:"normal",duedate:"",members:[],subtasks:[],attachments:[],comments:[]}},init:function(){var t=this;e.getJSON("../../../assets/data/taskboard.json",function(a){var s=e("#taskboard-stages");t.buildStage(s,a),t.initSortable()})},buildStage:function(t,a){if(0!==a.length){var s=this;e.each(a,function(a,i){var n=e(s.stageTpl(i.title,i.type));s.buildTask(n,i.tasks),t.append(n)})}},buildTask:function(t,a,s){if(0!==a.length){var i=this,n=e(".taskboard-list",t);if(s){var l=e(i.taskTpl(a));i.buildBadges(l,a),l.data("taskInfo",a),t.append(l)}else e.each(a,function(t,a){var s=e(i.taskTpl(a));i.buildBadges(s,a),i.buildMembers(s,a.members),s.data("taskInfo",a),n.append(s)})}},buildBadges:function(t,a){var s=this,i="",n=a.duedate,l=a.subtasks,o=a.attachments,d=a.comments;if(n.length>0&&(i+=s.badgesTpl("duedate",n.split(/\//,2).join("/"))),l.length>0){var c=0;e.each(l,function(t,a){a.complete&&c++}),i+=s.badgesTpl("subtasks",c+"/"+l.length)}o.length>0&&(i+=s.badgesTpl("attachments",o.length)),d.length>0&&(i+=s.badgesTpl("comments",d.length)),t.find(".task-badges").html(i)},buildMembers:function(t,a){var s=this,i="";0!==a.length&&(e.each(a,function(t,a){i+=s.membersTpl(a.img)}),t.find(".task-members").html(i))},initSortable:function(){e(".taskboard-stages").sortable({handle:".taskboard-stage-header"}),e(".taskboard-stage .list-group").sortable({connectWith:".taskboard-stage .list-group"})},handleAddStage:function(){var a=this;e(t).on("click",".site-floataction",function(){var t=e("#addStageFrom");e("input",t).val(""),e("option:first",e("select",t)).prop("selected","selected")}),e(t).on("click","#taskboard-stage-creat",function(){var t=(e(this),e("#addStageFrom")),s=e('[name="name"]',t);e(".taskboard-stages").append(a.stageTpl(s.val())),a.initSortable()})},handleDeleteStage:function(){e(t).on("click",".taskboard-stage-delete",function(){var t=e(this);bootbox.dialog({message:"Do you want to delete the stage?",buttons:{success:{label:"Delete",className:"btn-danger",callback:function(){t.closest(".taskboard-stage").remove()}}}})})},getStage:function(t){return t.closest(".taskboard-stage")},initStageDropdown:function(){e(t).on("click",".taskboard-stage-actions .dropdown-toggle",function(){e(this).next(".dropdown-menu").removeClass("is-edit")})},handleStageRename:function(){e(t).on("click",".taskboard-stage-rename",function(t){var a=e(this).closest(".taskboard-stage-header"),s=e(this).closest(".dropdown-menu"),i=e(".taskboard-stage-rename-input",s),n=e(".taskboard-stage-title",a);s.toggleClass("is-edit"),i.val("").focus().val(n.html()),t.stopPropagation()}),e(t).on("click",".taskboard-stage-rename-save",function(){var t=e(this).closest(".taskboard-stage-header"),a=e(".taskboard-stage-rename-input",t),s=e(".taskboard-stage-title",t),i=a.val();0!==i.length&&s.html(i)})},handleAddTask:function(){var a=this;e(t).on("click",".add-item-toggle, .add-item-add, .add-item-cancel",function(){var a=e(this),s=a.closest(".action-wrap"),i=e('[name="name"]',s);s.toggleClass("action-open"),a.hasClass("add-item-toggle")&&i.val(""),a.hasClass("add-item-toggle")?e(t).on("click.add-item",function(a){0===e(a.target).closest(".add-item-wrap").length&&(s.removeClass("action-open"),e(t).off("click.add-item"))}):e(t).off("click.add-item")}),e(t).on("click",".add-item-add",function(){var t=e(this),s=t.closest(".action-wrap"),i=e('[name="name"]',s),n=e(".taskboard-list",t.closest(".taskboard-stage-content")),l=a.dataTpl();0!==i.val().length&&(l.title=i.val(),a.buildTask(n,l,!0))})},handleDeleteTask:function(){e(t).on("click",".taskboard-task-delete",function(){var t=e(this);bootbox.dialog({message:"Do you want to delete the task?",buttons:{success:{label:"Delete",className:"btn-danger",callback:function(){t.closest(".slidePanel").data("slidePanel").target.remove(),e(".slidePanel-close").trigger("click")}}}})})},handleTaskInput:function(){var a=this;e(t).on("click",".taskboard-list .checkbox-custom input",function(t){var s=e(this),i=s.closest(".list-group-item");a.dataChange(i,"complete",s.prop("checked")),t.stopPropagation()})},handlSlidePanelPlugin:function(){if(void 0!==e.slidePanel){var a=this,s=e.components.getDefaults("slidePanel"),i=e.extend({},s,{template:function(t){return'<div class="'+t.classes.base+" "+t.classes.base+"-"+t.direction+'"><div class="'+t.classes.base+'-scrollable"><div><div class="'+t.classes.content+'"></div></div></div><div class="'+t.classes.base+'-handler"></div></div>'},afterLoad:function(a){var s=this,i=e(a.target),n=i.data("taskInfo");this.$panel.find("."+this.options.classes.base+"-scrollable").asScrollable({namespace:"scrollable",contentSelector:">",containerSelector:">"}),this.$panel.find("#task-description").markdown(),n.duedate.length>0&&this.$panel.find("#taskDatepicker").data("date",n.duedate),this.$panel.find("#taskDatepicker").datepicker({autoclose:!1,todayHighlight:!0}).on("changeDate",function(){e("#taskDatepickerInput").val(s.$panel.find("#taskDatepicker").datepicker("getFormattedDate"))}),this.$panel.data("slidePanel",a),e(t).off("click.slidePanelDatepicker"),e(t).on("click.slidePanelDatepicker","span, td, th",function(t){t.stopPropagation()})},afterShow:function(){var a=this;e(t).on("click.slidePanelShow",function(t){0===e(t.target).closest(".slidePanel").length&&1===e(t.target).closest("body").length&&a.hide()})},afterHide:function(){e(t).off("click.slidePanelShow"),e(t).off("click.slidePanelDatepicker")},contentFilter:function(t,s){var i,n=e(s.target),l=n.data("taskInfo"),o=e(t);switch(e(".stage-name",o).html(e(".taskboard-stage-title",a.getStage(n)).html()),e(".task-title",o).html(l.title),l.priority){case"high":i=e("#priorityHigh",o);break;case"urgent":i=e("#priorityUrgent",o);break;default:i=e("#priorityNormal",o)}return i.prop("checked",!0),a.handleSelective(e('[data-plugin="jquery-selective"]',o),l.members),0===l.description.length?e(".description",o).addClass("is-empty"):e(".description-content",o).html(l.description),0!==l.subtasks.length&&(e.each(l.subtasks,function(t,s){var i=e(a.subtaskTpl(s));e(".subtasks-list",o).append(i)}),e(".subtasks",o).toggleClass("is-show")),0!==l.attachments.length&&(e.each(l.attachments,function(t,s){var i=e(a.attachmentTpl(s));e(".attachments-list",o).append(i)}),e(".attachments",o).toggleClass("is-show")),0!==l.comments.length&&e.each(l.comments,function(t,s){var i=e(a.commentTpl(s.src,s.user,s.time,s.content));e(".comments-history",o).append(i)}),o}});e(t).on("click",'[data-taskboard="slidePanel"]',function(t){var a=e(t.target).closest(".list-group-item");e.slidePanel.show({url:e(this).data("url"),target:a},i),t.stopPropagation()}),e(t).on("click","#fileuploadToggle",function(){e("#fileupload").trigger("click")})}},handleSelective:function(t,a){var s=this,i=function(){var t=this,a=[];return e.each(this._options.getOptions(this),function(s,i){e.each(t.options.local,function(t,s){s.id===e(i).val()&&a.push(s)})}),a},n=[{id:"uid_1",name:"Herman Beck",img:"../../../../global/portraits/1.jpg"},{id:"uid_2",name:"Mary Adams",img:"../../../../global/portraits/2.jpg"},{id:"uid_3",name:"Caleb Richards",img:"../../../../global/portraits/3.jpg"},{id:"uid_4",name:"June Lane",img:"../../../../global/portraits/4.jpg"},{id:"uid_5",name:"Edward Fletcher",img:"../../../../global/portraits/5.jpg"},{id:"uid_6",name:"Crystal Bates",img:"../../../../global/portraits/6.jpg"}];t.selective({namespace:"addMember",local:n,selected:a,buildFromHtml:!1,tpl:{optionValue:function(t){return t.id},frame:function(){return'<div class="'+this.namespace+'">'+this.options.tpl.items.call(this)+'<div class="'+this.namespace+'-trigger">'+this.options.tpl.triggerButton.call(this)+'<div class="'+this.namespace+'-trigger-dropdown">'+this.options.tpl.list.call(this)+"</div></div></div>"},triggerButton:function(){return'<div class="'+this.namespace+'-trigger-button"><i class="md-plus"></i></div>'},listItem:function(t){return'<li class="'+this.namespace+'-list-item"><img class="avatar" src="'+t.img+'">'+t.name+"</li>"},item:function(t){return'<li class="'+this.namespace+'-item"><img class="avatar" src="'+t.img+'">'+this.options.tpl.itemRemove.call(this)+"</li>"},itemRemove:function(){return'<span class="'+this.namespace+'-remove"><i class="md-minus-circle"></i></span>'},option:function(t){return'<option value="'+this.options.tpl.optionValue.call(this,t)+'">'+t.name+"</option>"}},onAfterItemAdd:function(){var t=this.$el.closest(".slidePanel").data("slidePanel").target,a=i.call(this);s.dataChange(t,"members",a)},onAfterItemRemove:function(){var t=this.$el.closest(".slidePanel").data("slidePanel").target,a=i.call(this);s.dataChange(t,"members",a)}})},handlePriority:function(){var a=this;e(t).on("click",'[name="priorities"]',function(){var t=e(this),s=t.closest(".slidePanel").data("slidePanel").target;a.dataChange(s,"priority",t.data("priority"))})},handleEditor:function(){var a=this;e(t).on("click",".slidePanel .task-title, .taskboard-task-edit, .description-toggle",function(){var t=e(this),a=t.closest(".slidePanel").data("slidePanel").target,s=a.data("taskInfo");e("#task-title").val(s.title),e("#task-description").val(s.description),t.closest(".slidePanel").find(".task-main").addClass("is-edit")}),e(t).on("click",".task-main-editor-save",function(){var t=e(this),s=t.closest(".slidePanel").data("slidePanel").target;s.data("taskInfo");a.dataChange(s,"title",e("#task-title").val()),a.dataChange(s,"description",e("#task-description").val()),t.closest(".slidePanel").find(".task-main").removeClass("is-edit"),0===e("#task-description").val().length?e(".description").addClass("is-empty"):e(".description").removeClass("is-empty")}),e(t).on("click",".task-main-editor-cancel",function(){e(this).closest(".slidePanel").find(".task-main").removeClass("is-edit")})},handleSubtasks:function(){var a=this;e(t).on("click",".subtask-toggle",function(){var a=e(".subtask").length,s=e(".subtasks-add .subtask-title"),i=e(".subtasks");s.val(""),0===a&&i.addClass("is-show"),i.addClass("is-edit"),s.focus(),e(t).on("click.subtask-add",function(a){0===e(a.target).closest(e(".subtasks-add")).length&&(i.removeClass("is-edit"),e(t).off("click.subtask-add"))})}),e(t).on("click",".subtask-add-save",function(){var t=e(".subtask").length,s=e(".subtasks"),i=e(".subtasks-add .subtask-title"),n=i.val(),l=e(this).closest(".slidePanel").data("slidePanel").target;if(0===n.length)0===t&&s.removeClass("is-show");else{var o={title:n,complete:!1},d=e(a.subtaskTpl(o));e(".subtasks-list").append(d),a.dataChange(l,"subtasks",o,t)}i.val("").focus()}),e(t).on("click",".subtask-add-cancel",function(){e(".subtasks").removeClass("is-edit"),e(t).off("click.subtask-add")}),e(t).on("click",".subtask input",function(){var t=e(this),s=t.closest(".slidePanel").data("slidePanel").target,i=t.closest(".subtask"),n=i.index();a.dataChange(s,"subtasks",t.prop("checked"),n,"complete")}),e(t).on("click",".subtask .title",function(){var a=e(this),s=a.closest(".slidePanel").data("slidePanel").target,i=s.data("taskInfo"),n=a.closest(".subtask"),l=n.index(),o=e(".subtask-title",n);n.addClass("is-edit"),o.val("").focus().val(i.subtasks[l].title),e(t).on("click.subtask",function(a){0===e(a.target).closest(n).length&&(n.removeClass("is-edit"),e(t).off("click.subtask"))})}),e(t).on("click",".subtask-editor-save",function(){var s=e(this),i=s.closest(".slidePanel").data("slidePanel").target,n=(i.data("taskInfo"),s.closest(".subtask")),l=n.index();a.dataChange(i,"subtasks",e(".subtask-title",n).val(),l,"title"),n.removeClass("is-edit"),e(t).off("click.subtask")}),e(t).on("click",".subtask-editor-delete",function(s){var i=e(this);bootbox.dialog({message:"Do you want to delete the subtask?",buttons:{success:{label:"Delete",className:"btn-danger",callback:function(){var s=i.closest(".slidePanel").data("slidePanel").target,n=(s.data("taskInfo"),i.closest(".subtask")),l=n.index();a.dataDelete(s,"subtasks",l),n.remove(),e(t).off("click.subtask"),0===e(".subtask").length&&e(".subtasks").removeClass("is-show")}}}})})},handleDatepicker:function(){var a=this;e(t).on("click",".due-date-save",function(){var t=e(this),s=t.closest(".slidePanel").data("slidePanel").target,i=e("#taskDatepickerInput").val();i.length>0&&a.dataChange(s,"duedate",i)}),e(t).on("click",".due-date-delete",function(){var t=e(this),s=t.closest(".slidePanel").data("slidePanel").target;0!==s.data("taskInfo").duedate.length&&(a.dataDelete(s,"duedate"),e("#taskDatepicker").datepicker("clearDates"))})},dataDelete:function(t,a,e){e?(t.data("taskInfo")[a].splice(e,1),this.dataDeleteResponse(t,a,e)):(t.data("taskInfo")[a]="",this.dataChangeResponse(t,a))},dataDeleteResponse:function(t,a,e){switch(a){case"duedate":case"subtasks":this.buildBadges(t,t.data("taskInfo"))}},dataChange:function(t,a,e,s,i){0!==e.length&&(void 0!==s?i?t.data("taskInfo")[a][s][i]=e:t.data("taskInfo")[a][s]=e:t.data("taskInfo")[a]=e,this.dataChangeResponse(t,a,e,s,i))},dataChangeResponse:function(t,a,s,i,n){switch(a){case"title":e(".task-title",t).html(s),e(".slidePanel .task-title").html(s);break;case"description":e(".slidePanel .description-content").html(s);break;case"priority":t.removeClass("priority-normal priority-high priority-urgent").addClass("priority-"+s);break;case"duedate":this.buildBadges(t,t.data("taskInfo"));break;case"members":this.buildMembers(t,t.data("taskInfo").members);break;case"subtasks":"title"===n?e(".title",e(".subtasks-list .subtask")[i]).html(s):this.buildBadges(t,t.data("taskInfo"))}},run:function(t){this.init(),this.handleAddStage(),this.handleDeleteStage(),this.handleAddTask(),this.handleDeleteTask(),this.handleTaskInput(),this.initStageDropdown(),this.handleStageRename(),this.handleDatepicker(),this.handlSlidePanelPlugin(),this.handleEditor(),this.handleSubtasks(),this.handlePriority(),t()}}),e(t).ready(function(){AppTaskboard.run()})}(document,window,jQuery);