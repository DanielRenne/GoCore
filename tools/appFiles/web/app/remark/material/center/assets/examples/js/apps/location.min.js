/*!
 * remark (http://getbootstrapadmin.com/remark)
 * Copyright 2017 amazingsurge
 * Licensed under the Themeforest Standard Licenses
 */
!function(i,n,e){"use strict";n.AppLocation=App.extend({handleMap:function(){function i(){for(var i=[],n=[],a=0;a<t.allMarkers.length;a++)d.getBounds().contains(t.allMarkers[a].getLatLng())&&i.push(t.allMarkers[a].options.alt);for(var a=0;a<t.allFriends.length;a++)-1===i.indexOf(t.allFriends[a].attr("data-friend-id"))?t.allFriends[a].hide():t.allFriends[a].show();for(var a=0;a<i.length;a++)e(".app-location .friend-info").each(function(){e(this).attr("data-friend-id")===i[a]&&n.push(e(this))});t.inListFriends=n}var t=this,a=e(".site-navbar").outerHeight(),r=e(".site-footer").outerHeight(),s=e(n).height()-a-r;e(".page-main").outerHeight(s);var o=L.latLng(37.769,-122.446),l=e(".app-location .friend-info");l.each(function(){t.allFriends.push(e(this))}),L.mapbox.accessToken="pk.eyJ1IjoiYW1hemluZ3N1cmdlIiwiYSI6ImNpaDVubzBoOTAxZG11dGx4OW5hODl2b3YifQ.qudwERFDdMJhFA-B2uO6Rg";var d=L.mapbox.map("map","mapbox.light").setView(o,18);l.each(function(){t.allFriendId.push(e(this).attr("data-friend-id"))});var h=new L.MarkerClusterGroup({removeOutsideVisibleBounds:!1,polygonOptions:{color:"#444"}});!function(i,n){for(var e=0;e<n.length;e++){var a,r;a=e%2==0?1*Math.random():-1*Math.random();var s=L.latLng(37.769+Math.random()/170*a,Math.random()/150*a-122.446);r=n[e].find("img").attr("src");var o="<div class='in-map-markers'><div class='friend-icon'><img src='"+r+"' alt='"+i[e]+"' /></div></div>",c=L.divIcon({html:o,iconAnchor:[0,0],className:""}),f="<div class='friend-popup-info'><div class='detail'>info</div><h3>"+n[e].find(".friend-name").html()+"</h3><p>"+n[e].find(".friend-title").html()+"</p></div><i class='icon md-chevron-right'></i>",p=L.marker(s,{alt:i[e],title:l[e].getElementsByClassName("friend-name")[0].innerHTML,icon:c}).bindPopup(f,{closeButton:!1});h.addLayer(p),t.allMarkers.push(p),p.on("popupopen",function(){this._icon.className+=" marker-active",this.setZIndexOffset(999)}),p.on("popupclose",function(){this._icon&&(this._icon.className="leaflet-marker-icon leaflet-zoom-animated leaflet-clickable"),this.setZIndexOffset(450)})}d.addLayer(h)}(t.allFriendId,t.allFriends),d.once("ready",i),d.on("viewreset",i),d.on("moveend",i),this.handleClickAction(d)},handleFind:function(){var i=this;e(".search-friends input").on("focus",function(){e(this).on("keyup",function(){for(var n=e(".search-friends input").val(),t=0;t<i.inListFriends.length;t++){var a=i.inListFriends[t].find(".friend-name").html();if(n.length<=a.length)for(var r=1;r<=n.length;r++)n.substring(0,r).toLowerCase()===a.substring(0,r).toLowerCase()?i.inListFriends[t].show():i.inListFriends[t].hide();else i.inListFriends[t].hide()}if(""===n)for(var t=0;t<i.inListFriends.length;t++)i.inListFriends[t].show()})}),e(".search-friends input").on("focusout",function(){e(this).off("keyup")})},handleResize:function(){e(n).on("resize",function(){var i=e(".site-navbar").outerHeight(),t=e(".site-footer").outerHeight(),a=e(n).height()-i-t;e(".page-main").outerHeight(a)})},handleClickAction:function(i){var n=this;e(".app-location .page-aside .list-group").on("click",".widget-content",function(){var t=e(this).parents(".friend-info").attr("data-friend-id");e(".list-inline").on("click",function(i){i.stopPropagation()});for(var a=0;a<n.allMarkers.length;a++)n.allMarkers[a].options.alt===t&&(i.panTo(n.allMarkers[a].getLatLng()),n.allMarkers[a].openPopup())})},run:function(){this.allFriends=[],this.allFriendId=[],this.allMarkers=[],this.inListFriends=[],this.handleMap(),this.handleResize(),this.handleFind()}}),e(i).ready(function(i){AppLocation.run()})}(document,window,jQuery);